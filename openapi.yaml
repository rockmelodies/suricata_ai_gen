openapi: 3.0.0
info:
  title: Suricataè§„åˆ™ç”ŸæˆAPI
  version: 2.0.0
  description: |
    åŸºäºAIçš„Suricataè§„åˆ™ç”Ÿæˆã€ä¼˜åŒ–ä¸éªŒè¯å¹³å°
    
    ## åŠŸèƒ½ç‰¹æ€§
    - ğŸ¤– AIé©±åŠ¨çš„è§„åˆ™ç”Ÿæˆ
    - ğŸ”„ æ™ºèƒ½è§„åˆ™ä¼˜åŒ–
    - âœ… PCAPæ–‡ä»¶éªŒè¯
    - ğŸ‘¥ ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ
    - ğŸ” JWTè®¤è¯æˆæƒ
    
    ## è®¤è¯æ–¹å¼
    ä½¿ç”¨JWT Bearer Tokenè¿›è¡Œè®¤è¯ã€‚é¦–å…ˆè°ƒç”¨ `/api/auth/login` è·å–tokenï¼Œ
    ç„¶ååœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ : `Authorization: Bearer <token>`

servers:
  - url: http://localhost:5000/api
    description: å¼€å‘æœåŠ¡å™¨
  - url: https://your-domain.com/api
    description: ç”Ÿäº§æœåŠ¡å™¨

tags:
  - name: è®¤è¯
    description: ç”¨æˆ·è®¤è¯ç›¸å…³æ¥å£
  - name: ç”¨æˆ·ç®¡ç†
    description: ç”¨æˆ·CRUDæ“ä½œï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰
  - name: è§„åˆ™ç®¡ç†
    description: Suricataè§„åˆ™çš„ç”Ÿæˆã€æŸ¥è¯¢ã€ä¼˜åŒ–
  - name: è§„åˆ™éªŒè¯
    description: ä½¿ç”¨PCAPæ–‡ä»¶éªŒè¯è§„åˆ™

paths:
  /auth/register:
    post:
      summary: ç”¨æˆ·æ³¨å†Œ
      tags: [è®¤è¯]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                  example: testuser
                password:
                  type: string
                  format: password
                  example: password123
                email:
                  type: string
                  format: email
                  example: user@example.com
      responses:
        201:
          description: æ³¨å†ŒæˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        400:
          description: è¯·æ±‚å‚æ•°é”™è¯¯

  /auth/login:
    post:
      summary: ç”¨æˆ·ç™»å½•
      tags: [è®¤è¯]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                  example: admin
                password:
                  type: string
                  format: password
                  example: admin123
      responses:
        200:
          description: ç™»å½•æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        401:
          description: ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯

  /auth/me:
    get:
      summary: è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
      tags: [è®¤è¯]
      security:
        - BearerAuth: []
      responses:
        200:
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        401:
          description: æœªæˆæƒ

  /users:
    get:
      summary: è·å–ç”¨æˆ·åˆ—è¡¨
      tags: [ç”¨æˆ·ç®¡ç†]
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: per_page
          in: query
          schema:
            type: integer
            default: 20
      responses:
        200:
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  users:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'
                  total:
                    type: integer
                  page:
                    type: integer
                  per_page:
                    type: integer
        403:
          description: æƒé™ä¸è¶³ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰

  /users/{user_id}:
    get:
      summary: è·å–ç”¨æˆ·è¯¦æƒ…
      tags: [ç”¨æˆ·ç®¡ç†]
      security:
        - BearerAuth: []
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        404:
          description: ç”¨æˆ·ä¸å­˜åœ¨

    put:
      summary: æ›´æ–°ç”¨æˆ·ä¿¡æ¯
      tags: [ç”¨æˆ·ç®¡ç†]
      security:
        - BearerAuth: []
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserUpdate'
      responses:
        200:
          description: æ›´æ–°æˆåŠŸ
        403:
          description: æƒé™ä¸è¶³

    delete:
      summary: åˆ é™¤ç”¨æˆ·
      tags: [ç”¨æˆ·ç®¡ç†]
      security:
        - BearerAuth: []
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: åˆ é™¤æˆåŠŸ
        403:
          description: æƒé™ä¸è¶³ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰
        404:
          description: ç”¨æˆ·ä¸å­˜åœ¨

  /rules/generate:
    post:
      summary: ç”ŸæˆSuricataè§„åˆ™
      tags: [è§„åˆ™ç®¡ç†]
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RuleGenerateRequest'
      responses:
        200:
          description: è§„åˆ™ç”ŸæˆæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  rule_id:
                    type: integer
                  generated_rule:
                    type: string
        400:
          description: è¯·æ±‚å‚æ•°é”™è¯¯

  /rules:
    get:
      summary: è·å–è§„åˆ™åˆ—è¡¨
      tags: [è§„åˆ™ç®¡ç†]
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: per_page
          in: query
          schema:
            type: integer
            default: 20
      responses:
        200:
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  rules:
                    type: array
                    items:
                      $ref: '#/components/schemas/Rule'
                  total:
                    type: integer
                  page:
                    type: integer
                  per_page:
                    type: integer

  /rules/{rule_id}:
    get:
      summary: è·å–è§„åˆ™è¯¦æƒ…
      tags: [è§„åˆ™ç®¡ç†]
      security:
        - BearerAuth: []
      parameters:
        - name: rule_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  rule:
                    $ref: '#/components/schemas/Rule'
        404:
          description: è§„åˆ™ä¸å­˜åœ¨

  /rules/optimize:
    post:
      summary: ä¼˜åŒ–è§„åˆ™
      tags: [è§„åˆ™ç®¡ç†]
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RuleOptimizeRequest'
      responses:
        200:
          description: ä¼˜åŒ–æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  optimized_rule:
                    type: string

  /validate:
    post:
      summary: éªŒè¯Suricataè§„åˆ™
      tags: [è§„åˆ™éªŒè¯]
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ValidateRequest'
      responses:
        200:
          description: éªŒè¯å®Œæˆ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  validation_result:
                    type: object

  /health:
    get:
      summary: å¥åº·æ£€æŸ¥
      responses:
        200:
          description: æœåŠ¡æ­£å¸¸
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  timestamp:
                    type: string
                  version:
                    type: string

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: è¾“å…¥æ ¼å¼ï¼šBearer <access_token>

  schemas:
    AuthResponse:
      type: object
      properties:
        access_token:
          type: string
          description: JWTè®¿é—®ä»¤ç‰Œ
        user:
          $ref: '#/components/schemas/User'

    User:
      type: object
      properties:
        id:
          type: integer
        username:
          type: string
        email:
          type: string
        role:
          type: string
          enum: [user, admin]
        is_active:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    UserUpdate:
      type: object
      properties:
        username:
          type: string
        email:
          type: string
        role:
          type: string
          enum: [user, admin]
        is_active:
          type: integer

    RuleGenerateRequest:
      type: object
      required:
        - vuln_name
        - vuln_description
      properties:
        vuln_name:
          type: string
          description: æ¼æ´åç§°
          example: "Apache Struts2 è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´"
        vuln_description:
          type: string
          description: æ¼æ´æè¿°
          example: "æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„è¯·æ±‚æ‰§è¡Œä»»æ„ä»£ç "
        vuln_type:
          type: string
          description: æ¼æ´ç±»å‹
          example: "å‘½ä»¤æ³¨å…¥"
        poc:
          type: string
          description: POCç¤ºä¾‹

    Rule:
      type: object
      properties:
        id:
          type: integer
        vuln_name:
          type: string
        vuln_type:
          type: string
        description:
          type: string
        original_rule:
          type: string
        current_rule:
          type: string
        created_at:
          type: string
        updated_at:
          type: string

    RuleOptimizeRequest:
      type: object
      required:
        - current_rule
      properties:
        rule_id:
          type: integer
        current_rule:
          type: string
        feedback:
          type: string
        validation_result:
          type: string

    ValidateRequest:
      type: object
      required:
        - rule_content
      properties:
        rule_content:
          type: string
          description: è§„åˆ™å†…å®¹
        rule_id:
          type: integer
          description: è§„åˆ™ID
        pcap_path:
          type: string
          description: PCAPæ–‡ä»¶è·¯å¾„
          default: /home/kali/pcap_check
